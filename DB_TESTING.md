# üß™ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ë–î

–°–ª–µ–¥—É–π—Ç–µ —ç—Ç–∏–º —à–∞–≥–∞–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

## 1Ô∏è‚É£ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

```powershell
python init_test_db.py
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –°–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª `database.db`
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å—Ö–µ–º–∞ –ë–î (—Ç–∞–±–ª–∏—Ü—ã `users`, `scores`)
- –î–æ–±–∞–≤–ª—è—é—Ç—Å—è 5 —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –î–æ–±–∞–≤–ª—è—é—Ç—Å—è 13 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–≥—Ä —Å —Ä–∞–∑–Ω—ã–º–∏ –æ—á–∫–∞–º–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—ã —É–≤–∏–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ –∏ —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

---

## 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ë–î

```powershell
python check_db.py
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è:**
- –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü `users` –∏ `scores`
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π: –ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç DESC, –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è ASC
- –í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä–æ–∫–æ–≤
- –ò–Ω–¥–µ–∫—Å—ã: `idx_scores_user`, `idx_scores_points`
- –†–µ–∂–∏–º –ë–î: WAL (Write-Ahead Logging)
- –°—Ç–∞—Ç—É—Å Foreign Keys

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º –ë–î.

---

## 3Ô∏è‚É£ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Flask

```powershell
python app.py
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://127.0.0.1:5000`

**–ß—Ç–æ –¥–æ—Å—Ç—É–ø–Ω–æ:**
- `GET /` ‚Äî –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `GET /rules` ‚Äî —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–∞–≤–∏–ª
- `POST /api/spin` ‚Äî —Ä–æ—Ç–∞—Ü–∏—è —Ä—É–ª–µ—Ç–∫–∏
- `GET /api/leaderboard` ‚Äî –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –∏–∑ –ë–î

---

## 4Ô∏è‚É£ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API (PowerShell)

### –ü–æ–ª—É—á–∏—Ç—å –ª–∏–¥–µ—Ä–±–æ—Ä–¥:
```powershell
$response = Invoke-WebRequest -Uri "http://127.0.0.1:5000/api/leaderboard"
$response.Content | ConvertFrom-Json | Format-Table
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–∞–±–ª–∏—Ü–∞ —Å `username`, `best_score`, `first_played`

### –ö—Ä—É—Ç–∏—Ç—å —Ä—É–ª–µ—Ç–∫—É:
```powershell
$body = @{"nickname"="TestPlayer"} | ConvertTo-Json
$response = Invoke-WebRequest -Uri "http://127.0.0.1:5000/api/spin" -Method POST -ContentType "application/json" -Body $body
$response.Content | ConvertFrom-Json | Format-Table
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–ø–∏–Ω–∞ —Å –æ—á–∫–∞–º–∏ –∏ —Ç–∏–ø–æ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏.

---

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î

### –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ë–î —Å –Ω—É–ª—è:

```powershell
# 1. –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –ë–î
Remove-Item database.db -Force
Remove-Item database.db-wal -Force
Remove-Item database.db-shm -Force

# 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é
python init_test_db.py
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Flask CLI –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:

```powershell
$env:FLASK_APP = 'app.py'
flask init-db
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `users`:
```
id          INTEGER PRIMARY KEY (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)
username    TEXT UNIQUE NOT NULL (–Ω–∏–∫–Ω–µ–π–º –∏–≥—Ä–æ–∫–∞)
created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP
```

### –¢–∞–±–ª–∏—Ü–∞ `scores`:
```
id          INTEGER PRIMARY KEY (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)
user_id     INTEGER NOT NULL (—Å—Å—ã–ª–∫–∞ –Ω–∞ users.id, ON DELETE CASCADE)
points      INTEGER NOT NULL (–æ—á–∫–∏ –∑–∞ –∏–≥—Ä—É)
reels_json  TEXT NOT NULL DEFAULT '[]' (JSON —Å –±–∞—Ä–∞–±–∞–Ω–∞–º–∏)
created_at  TIMESTAMP DEFAULT CURRENT_TIMESTAMP (–¥–∞—Ç–∞ –∏–≥—Ä—ã)
```

### –ò–Ω–¥–µ–∫—Å—ã:
- `idx_scores_user` ‚Äî —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- `idx_scores_points` ‚Äî —É—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –æ—á–∫–∞–º

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] `python init_test_db.py` —Å–æ–∑–¥–∞–ª –ë–î –∏ –∑–∞–ø–æ–ª–Ω–∏–ª –µ—ë –¥–∞–Ω–Ω—ã–º–∏
- [ ] `python check_db.py` –ø–æ–∫–∞–∑–∞–ª –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- [ ] `python app.py` –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] `GET /api/leaderboard` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ –ë–î
- [ ] –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω: –ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –Ω–∞—á–∞–ª–µ
- [ ] –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] WAL —Ä–µ–∂–∏–º –≤–∫–ª—é—á–µ–Ω
- [ ] FOREIGN KEY –≤–∫–ª—é—á–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏

---

## üêõ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ë–î –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è:**
   ```powershell
   python -m py_compile init_test_db.py  # –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
   ```

2. **–¢–∞–±–ª–∏—Ü—ã –Ω–µ –≤–∏–¥–Ω—ã –≤ check_db.py:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `init_test_db.py` –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
   - –£–¥–∞–ª–∏—Ç–µ `database.db*` —Ñ–∞–π–ª—ã –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ

3. **Flask –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:**
   ```powershell
   python app.py  # –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
   ```

4. **API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥:**
   - –ó–∞–ø—É—Å—Ç–∏—Ç–µ `python check_db.py` ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –ë–î –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `db.get_top_players()` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### Python –∫–æ–¥ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î:
```python
import db
from app import app

with app.app_context():
    # –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤
    leaderboard = db.get_top_players(limit=10)
    for player in leaderboard:
        print(f"{player['username']}: {player['best_score']} –æ—á–∫–æ–≤")
    
    # –ü–æ–ª—É—á–∏—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –¥–ª—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
    database = db.get_db()
    cursor = database.execute("SELECT COUNT(*) FROM scores")
    total_scores = cursor.fetchone()[0]
    print(f"–í—Å–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: {total_scores}")
```

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –ë–î!

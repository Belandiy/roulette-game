# Техническое задание

## 1. Цель проекта
Создать учебное веб-приложение **«Рулетка с турнирной таблицей»**.  
Пользователь крутит рулетку (3 цилиндра), получает очки за комбинации, а результаты сохраняются в таблице **ТОП-10 игроков**.

---

## 2. Функционал
- Интерфейс рулетки (3 цилиндра с анимацией).  
- Кнопка **«Крутить»**.  
- Подсчёт очков за комбинации.  
- Сохранение результата игрока в базе данных.  
- Отображение турнирной таблицы (ТОП-10 игроков).  
- Простое оформление интерфейса (HTML + CSS).  
- Страница «Правила игры».  
- Минимальная регистрация (никнейм).  

---

## 3. Архитектура
- **Backend:** Python + Flask.  
- **База данных:** SQLite (таблицы `users: id, username, created_at` и `scores: id, user_id, points, reels_json, created_at`).  
- **Frontend:** HTML, CSS (стили и адаптивность), JS (логика рулетки).  
- **Шаблонизатор:** Jinja2 (во Flask).  

---

## 4. Структура проекта
```
roulette/
├── app.py
├── db.py
├── schema.sql
├── scoring.py
├── requirements.txt
│
├── static/
│   ├── app.js
│   └── styles.css
│
└── templates/
    ├── base.html
    ├── index.html
    ├── rules.html
    └── _leaderboard.html
```

---

## 5. План разработки (спринты)

По окончанию каждого спринта необходимо ревью перподавателя в Pull Request и прикрепляется ссылка на него.

### Спринт 1 — Настройка и постановка задач
1. Создать репозиторий на GitHub.  
2. Создать Milestone **«Постановка задачи»**.  
3. Оформить `README.md` (описание проекта, состав команды, ссылки на ТЗ).  
4. Создать `Техническое задание.md`.  
5. Создать Issues (15 задач, по 3 для каждого участника).  
6. Подготовить минимальный рабочий проект (Flask + HTML-шаблон + SQLite) — выполняет **главный разработчик**.  

---

### Спринт 2 — каркас и заглушки

**1) Бэкенд-разработчик (Flask + API)**
Обязанности: поднять приложение, базовые маршруты, сессии.
Файлы: `app.py`
Коммиты: `GET /, GET /rules`, логика для `POST /api/spin`, `GET /api/leaderboard`, сессия.

**2) Разработчик базы данных**
Обязанности: подключение к SQLite, первичная схема.
Файлы: `db.py`, `schema.sql`
Коммиты: `get_db()`, `init_db()`, `ensure_db()`; в `schema.sql` — таблицы `users`, `scores` без индексов.

**3) Игровая логика**
Обязанности: определить интерфейс логики.
Файлы: `scoring.py`
Коммиты: заглушки `spin_reels(n)` и `score(reels)` возвращают фиксированные значения; список символов наброском.

**4) Фронтенд (JS)**
Обязанности: базовые обработчики и вызовы API.
Файлы: `static/app.js`
Коммиты: инициализация DOM, обработчик кнопки «Крутить», `fetch` к заглушке `/api/spin`, функция `loadLeaderboard()` к `/api/leaderboard` без анимации.

**5) Верстальщик / UI-дизайнер**
Обязанности: первичная верстка страниц и базовые стили.
Файлы: `templates/base.html`, `templates/index.html`, `templates/rules.html`, `templates/_leaderboard.html`, `static/styles.css`
Коммиты: каркас макета, форма никнейма, блок рулетки из 3 «барабанов», таблица ТОП-10, базовая тема и сетка.

---

### Спринт 3 — рабочая функциональность

**1) Бэкенд-разработчик (Flask + API)**
Обязанности: реализовать API и запись результатов.
Файлы: `app.py`
Коммиты: полная реализация `POST /api/spin` (чтение `user_id` из сессии, вызов логики, INSERT в `scores`), `GET /api/leaderboard` (агрегация MAX(points) по пользователю), обработка 401 для незарегистрированных, редирект после ввода никнейма.

**2) Разработчик базы данных**
Обязанности: завершить схему и оптимизацию.
Файлы: `db.py`, `schema.sql`
Коммиты: PRAGMA `WAL`, `foreign_keys=ON`, индексы `idx_scores_user`, `idx_scores_points`, корректные DEFAULT-ы времени, упорядочивание выборок.

**3) Игровая логика**
Обязанности: честный RNG и правила очков.
Файлы: `scoring.py`
Коммиты: выбор через `secrets.choice`, взвешенная «колода», правила: 3 одинаковых с разными наградами, пара = 10, «777» = 500.

**4) Фронтенд (JS)**
Обязанности: анимация рулетки и обновление UI.
Файлы: `static/app.js`
Коммиты: `animateTo(targets)` с псевдоспином, дизейбл кнопки на время вращения, вывод очков, лучший результат, обновление таблицы ТОП-10.

**5) Верстальщик / UI-дизайнер**
Обязанности: довести UI до рабочего состояния.
Файлы: `templates/*`, `static/styles.css`
Коммиты: стили барабанов, кнопок, таблицы; доработка `index.html` под динамические поля очков; наполнение `rules.html`.

---

### Спринт 4 — полировка и мелкие улучшения

**1) Бэкенд-разработчик (Flask + API)**
Обязанности: валидация и удобные ответы.
Файлы: `app.py`
Коммиты: проверка никнейма (длина, regexp), вычисление `best_points` пользователя, `rank_hint` в ответе спина, CLI `flask init-db`.

**2) Разработчик базы данных**
Обязанности: финальный тюнинг выборок.
Файлы: `schema.sql`, `db.py`
Коммиты: уточнение ORDER BY для лидерборда (`best_points DESC, MIN(created_at) ASC`), лёгкая очистка кода и проверка `ensure_db()`, CLI команда `flask init-db`, добавить регистрацию CLI команды в db.init_app(app).

**3) Игровая логика**
Обязанности: баланс и читабельность.
Файлы: `scoring.py`
Коммиты: финальные значения множителей, комментарии к таблицам очков, упрощение кода без изменения API.

**4) Фронтенд (JS)**
Обязанности: UX-мелочи и обработка ошибок.
Файлы: `static/app.js`
Коммиты: сообщения об ошибках сети и 401, мелкая задержка между барабанами, очистка статуса, небольшие рефакторы.

**5) Верстальщик / UI-дизайнер**
Обязанности: визуальная полировка.
Файлы: `templates/*`, `static/styles.css`
Коммиты: акценты цветов, состояния кнопок, мелкие отступы, адаптив для ширины < 400px, улучшение читаемости таблицы.
 

---

## 6. Используемые инструменты
- Python 3  
- Flask  
- SQLite  
- HTML, CSS, JavaScript  
- GitHub (репозиторий, Issues, Milestones, Pull Requests)

# üìã –ò–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è Sprint 4 –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ë–î

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. **init_test_db.py** ‚Äî –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- –°–æ–∑–¥–∞—ë—Ç —Å—Ö–µ–º—É –ë–î (—Ç–∞–±–ª–∏—Ü—ã `users`, `scores` —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏)
- –í–∫–ª—é—á–∞–µ—Ç PRAGMA WAL –∏ Foreign Keys
- –î–æ–±–∞–≤–ª—è–µ—Ç 5 —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –î–æ–±–∞–≤–ª—è–µ—Ç 13 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–≥—Ä —Å —Ä–∞–∑–Ω—ã–º–∏ –æ—á–∫–∞–º–∏ (0, 20, 100, 500)
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –∏ –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –∫–æ–Ω—Å–æ–ª–∏

**–ó–∞–ø—É—Å–∫:**
```powershell
python init_test_db.py
```

---

### 2. **check_db.py** ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ë–î
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –∏–Ω–¥–µ–∫—Å–æ–≤
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (–∫–æ–ª-–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
- –í—ã–≤–æ–¥–∏—Ç –ª–∏–¥–µ—Ä–±–æ—Ä–¥ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–≥—Ä–æ–∫–æ–≤
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–∂–∏–º B–î (WAL) –∏ —Å—Ç–∞—Ç—É—Å Foreign Keys

**–ó–∞–ø—É—Å–∫:**
```powershell
python check_db.py
```

---

### 3. **test_api.py** ‚Äî –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API endpoints
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `GET /` (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `GET /rules` (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–∞–≤–∏–ª)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `POST /api/spin` (—Ä—É–ª–µ—Ç–∫–∞)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `GET /api/leaderboard` (–ª–∏–¥–µ—Ä–±–æ—Ä–¥ –∏–∑ –ë–î)

**–ó–∞–ø—É—Å–∫:**
```powershell
python app.py  # –≤ –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
python test_api.py  # –≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
```

---

### 4. **DB_TESTING.md** ‚Äî –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏:
- –ö–∞–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î
- –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
- –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å API
- –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ db.py

### –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã:
```python
import click
from flask.cli import with_appcontext
```

### –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_top_players(limit=10)`:
- –ü–æ–ª—É—á–∞–µ—Ç —Ç–æ–ø –∏–≥—Ä–æ–∫–æ–≤ –∏–∑ –ë–î
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: `MAX(points) DESC, MIN(created_at) ASC` (–∫–∞–∫ –≤ –¢–ó Sprint 4)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç LEFT JOIN –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –ø–æ–ª—è–º–∏: `username`, `best_score`, `first_played`

### –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `init_app(app)`:
```python
@app.cli.command('init-db')
@with_appcontext
def init_db_command():
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ø–æ schema.sql"""
    init_db()
    click.echo('Initialized the database.')
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```powershell
flask init-db
```

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ app.py

### –û–±–Ω–æ–≤–ª—ë–Ω endpoint `/api/leaderboard`:
–í–º–µ—Å—Ç–æ —Ñ–∏–∫—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –∏–∑ –ë–î:
```python
@app.route("/api/leaderboard")
def api_leaderboard():
    """–ü–æ–ª—É—á–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –¢–û–ü-10 –∏–≥—Ä–æ–∫–æ–≤"""
    leaderboard = db.get_top_players(limit=10)
    return jsonify(leaderboard), 200
```

---

## üìä –ß—Ç–æ —Å–µ–π—á–∞—Å –≤ –ë–î (–ø–æ—Å–ª–µ `init_test_db.py`)

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:** 5
- Champion (–ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 500)
- Player2 (–ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 500)
- Player1 (–ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 100)
- Player3 (–ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 20)
- NewbieGamer (–ª—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 0)

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:** 13 –∏–≥—Ä
- –†–∞–∑–Ω—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ (3 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö, –ø–∞—Ä–∞, –Ω–∏—á–µ–≥–æ)
- –†–∞–∑–ª–∏—á–Ω—ã–µ –æ—á–∫–∏ (0, 20, 100, 500)
- –†–∞–∑–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ë–î:**
- WAL —Ä–µ–∂–∏–º ‚úì
- Foreign Keys ‚úì
- –ò–Ω–¥–µ–∫—Å—ã: `idx_scores_user`, `idx_scores_points` ‚úì

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```powershell
# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ë–î —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
python init_test_db.py

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ë–î
python check_db.py

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
python app.py

# 4. –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# http://127.0.0.1:5000/api/leaderboard
```

---

## ‚ú® Sprint 4 —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ë–î

- ‚úÖ –£—Ç–æ—á–Ω–µ–Ω–∏–µ ORDER BY –¥–ª—è –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞ (`best_score DESC, MIN(created_at) ASC`)
- ‚úÖ –õ—ë–≥–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–æ–¥–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `ensure_db()` ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ CLI –∫–æ–º–∞–Ω–¥–∞ `flask init-db` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ `db.init_app(app)`

**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ Sprint 3:** 100% ‚úÖ –ù–∏–∫–∞–∫–∏—Ö –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, —Ç–æ–ª—å–∫–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.

---

## üìÅ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

```
roulette-game/
‚îú‚îÄ‚îÄ init_test_db.py      ‚Üê –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î
‚îú‚îÄ‚îÄ check_db.py          ‚Üê –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ë–î
‚îú‚îÄ‚îÄ test_api.py          ‚Üê —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API
‚îú‚îÄ‚îÄ DB_TESTING.md        ‚Üê –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
‚îî‚îÄ‚îÄ database.db          ‚Üê —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

---

**–ì–æ—Ç–æ–≤–æ!** üéâ –ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã –ë–î!
